import{d,a as p,g,s as c,b as l}from"./index-CVIS-iJZ.js";import"./vendor-DTH4L_Dn.js";import"./utils-CpJM9g8Q.js";import"./charts-C6-kGR6E.js";const a=2;function r(){const t=new Date().toLocaleString("en-US",{timeZone:"America/New_York"});return new Date(t).toISOString().split("T")[0]}async function h(t){const e=r();if(t)try{const s=d(p,"user_spins",`${t}_${e}`),o=await g(s);if(o.exists()){const n=o.data();return{remaining:a-(n.spinsUsed||0),used:n.spinsUsed||0,total:a,codesWon:n.codesWon||[]}}else return{remaining:a,used:0,total:a,codesWon:[]}}catch(s){return console.error("Error getting daily spins from Firestore:",s),{remaining:0,used:a,total:a,codesWon:[],error:s.message}}else return S()}function S(){const t=r(),e=localStorage.getItem("nhl_savant_daily_spins");if(e)try{const s=JSON.parse(e);if(s.date===t)return{remaining:a-(s.spinsUsed||0),used:s.spinsUsed||0,total:a,codesWon:s.codesWon||[]};localStorage.removeItem("nhl_savant_daily_spins")}catch(s){console.error("Error parsing localStorage spins:",s),localStorage.removeItem("nhl_savant_daily_spins")}return{remaining:a,used:0,total:a,codesWon:[]}}async function v(t,e){const s=r();if(t)try{const o=d(p,"user_spins",`${t}_${s}`),n=await g(o);if(n.exists()){const i=n.data();await c(o,{date:s,spinsUsed:(i.spinsUsed||0)+1,spinsTotal:a,codesWon:[...i.codesWon||[],e],lastSpinAt:l()})}else await c(o,{date:s,spinsUsed:1,spinsTotal:a,codesWon:[e],lastSpinAt:l()});console.log("âœ… Recorded spin in Firestore:",e)}catch(o){console.error("Error recording spin in Firestore:",o),m(e)}else m(e)}function m(t){const e=r(),s=localStorage.getItem("nhl_savant_daily_spins");let o={date:e,spinsUsed:0,codesWon:[]};if(s)try{const n=JSON.parse(s);n.date===e&&(o=n)}catch(n){console.error("Error parsing localStorage spins:",n)}o.spinsUsed=(o.spinsUsed||0)+1,o.codesWon=[...o.codesWon||[],t],localStorage.setItem("nhl_savant_daily_spins",JSON.stringify(o)),console.log("âœ… Recorded spin in localStorage:",t)}function W(){const t=r(),e=localStorage.getItem("nhl_savant_daily_spins");if(e)try{JSON.parse(e).date!==t&&(localStorage.removeItem("nhl_savant_daily_spins"),console.log("ðŸ”„ Reset daily spins for new day"))}catch(s){console.error("Error checking daily reset:",s),localStorage.removeItem("nhl_savant_daily_spins")}}async function U(t){const e=r(),s=localStorage.getItem("nhl_savant_daily_spins");if(s&&t)try{const o=JSON.parse(s);if(o.date===e&&o.spinsUsed>0){const n=d(p,"user_spins",`${t}_${e}`);(await g(n)).exists()||(await c(n,{date:e,spinsUsed:o.spinsUsed,spinsTotal:a,codesWon:o.codesWon||[],lastSpinAt:l(),migratedFrom:"localStorage"}),console.log("âœ… Migrated anonymous spins to Firestore"))}localStorage.removeItem("nhl_savant_daily_spins")}catch(o){console.error("Error migrating anonymous spins:",o)}}export{W as checkAndResetDaily,h as getDailySpins,U as migrateAnonymousSpins,v as recordSpin};
