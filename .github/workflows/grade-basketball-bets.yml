name: Grade Basketball Bets

on:
  workflow_dispatch:  # Manual trigger only

jobs:
  grade-bets:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
    
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
    
    - name: Install dependencies
      run: npm ci
    
    - name: Fetch latest basketball data (with results)
      env:
        FIRECRAWL_API_KEY: ${{ secrets.FIRECRAWL_API_KEY }}
      run: npm run fetch-basketball
    
    - name: Grade basketball bets
      env:
        FIREBASE_SERVICE_ACCOUNT: ${{ secrets.FIREBASE_SERVICE_ACCOUNT }}
      run: |
        echo "$FIREBASE_SERVICE_ACCOUNT" > service-account.json
        export VITE_FIREBASE_PROJECT_ID=$(jq -r '.project_id' service-account.json)
        export FIREBASE_CLIENT_EMAIL=$(jq -r '.client_email' service-account.json)
        export FIREBASE_PRIVATE_KEY=$(jq -r '.private_key' service-account.json)
        npm run grade-basketball-bets
        rm service-account.json

